function StoryteqVideoPlayer(e){var t=this;if(!e.videoPlayerId)throw new Error("Missing videoPlayerID.");if(t.videoPlayerId=e.videoPlayerId,t.tracking=!0,e.mediaData)t.mediaData=e.mediaData;else if(e.videoHash)t.videoHash=e.videoHash;else{if(!e.videoParameterName)throw new Error("Missing videoParameterName or videoHash or mediaData.");t.videoHash=t.getUrlParameter(e.videoParameterName)}e.verbose&&(t.verbose=e.verbose),0==e.tracking&&(t.tracking=e.tracking),e.dataCallbackFunction&&(t.dataCallbackFunction=e.dataCallbackFunction),e.defaultUrls&&(t.defaultUrls=e.defaultUrls),e.subs&&(t.subs=e.subs),e.playerSetup&&(t.playerSetup=e.playerSetup),e.googleTagManager&&(t.googleTagManager=e.googleTagManager,t.googleTagManager.eventCategory||(t.googleTagManager.eventCategory="Storyteq Video Player"),t.googleTagManager.event||(t.googleTagManager.event="gtm.storyteq.custom_event"),t.googleTagManager.enable||(t.googleTagManager.enable=!1)),e.events&&(t.events=e.events),e.posterUrl&&(t.posterUrl=e.posterUrl),e.noPoster&&(t.noPoster=e.noPoster),void 0!==e.autoplay&&(t.autoplay=e.autoplay),t.delta=20,t.durationOfVideo=null,t.timecodes=[],t.videoStarted=!1,t.firstPlay=!0,t.previousEvent=null,t.loadVideoJsCss()}function StoryteqConnectorJwPlayer(e){return new StoryteqVideoPlayer(e)}StoryteqVideoPlayer.prototype.loadVideoJsCss=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJsTheme():t.onload=function(){e.loadVideoJsTheme()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJsTheme=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js-theme.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJs():t.onload=function(){e.loadVideoJs()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJs=function(){var e=this,t=document.createElement("script");t.type="text/javascript",t.readyState?"loaded"===t.readyState&&e.getVideoData():t.onload=function(){e.getVideoData()},t.src="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.js",document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.createVideoPlayerInstance=function(e){var t=this,o=document.getElementById(t.videoPlayerId),a=document.createElement("video");a.id=t.videoPlayerId,a.className="video-js vjs-fluid",o.parentNode.replaceChild(a,o);var r=videojs(t.videoPlayerId,{poster:t.noPoster?"":t.posterUrl,sources:t.videoUrl,controls:!0,autoplay:0!=t.autoplay,preload:"auto",muted:0!=t.autoplay});if(t.videoUrl&&(t.verbose&&console.log("Video embedded"),document.getElementById(a.id).addEventListener("contextmenu",function(e){e.preventDefault()}),t.createAnalyticEmbed()),t.events)for(var n in t.events)r.on(n,t.events[n]);this.videoEventEmitter(r)},StoryteqVideoPlayer.prototype.round=function(e,t){var o=Math.pow(100,t||0);return Math.round(e*o)/o},StoryteqVideoPlayer.prototype.videoEventEmitter=function(t){var a=this;t.on("seeked",function(){a.timecodes.forEach(function(e){e.passed=!1})}),setInterval(function(){var o=t.currentTime();if(1<o&&null==a.durationOfVideo){a.durationOfVideo=t.duration();for(var e=0;e<=a.delta;e+=1)a.timecodes[e]={percentage:e/a.delta,value:e/a.delta*a.durationOfVideo,passed:!1}}null!=a.durationOfVideo&&a.timecodes.forEach(function(e){var t;o>=e.value&&o-e.value<a.durationOfVideo/a.delta&&0==e.passed?(t=a.round(100*e.percentage,1),a.previousEvent!=t&&(a.verbose&&console.log("Video watched for "+t+"%"),a.createAnalyticView(t),e.passed=!0,a.previousEvent=t)):a.skipNextEvent=!1})},500)},StoryteqVideoPlayer.prototype.analyticPostRequest=function(e,t){var o=this;if((null!=this.mediaData||null!=this.videoHash&&""!=this.videoHash)&&0!=this.tracking){var a=this.videoHash;null!=this.mediaData&&(a=mediaData.hash);var r=new XMLHttpRequest,n="https://api.storyteq.com/v4/open/media/"+a;if(r.open("POST",n),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-Content-Type-Options","nosniff"),r.send(JSON.stringify({type:e,meta:t})),window.dataLayer&&o.googleTagManager&&o.googleTagManager.enable){var i=o.formatAnalyticToGtmEvent(e,t);if(!i)return;window.dataLayer.push(i),o.verbose&&console.log(window.dataLayer)}}else o.verbose&&console.log("No analytics will be created since no unique hash has been provided or tracking has been disabled.")},StoryteqVideoPlayer.prototype.formatAnalyticToGtmEvent=function(e,t){var o=this,a=null;return"view"==e?a={event:o.googleTagManager.event,eventCategory:o.googleTagManager.eventCategory,eventAction:"view percentage",eventValue:t.percentage}:"embed"==e&&(a={event:o.googleTagManager.event,eventCategory:o.googleTagManager.eventCategory,eventAction:"embed"}),a&&o.googleTagManager.eventLabel&&(a.eventLabel=o.googleTagManager.eventLabel),a},StoryteqVideoPlayer.prototype.getVideoData=function(){var connector=this,xhr;connector.videoHash&&null!==connector.videoHash?(xhr=new XMLHttpRequest,xhr.open("GET","https://api.storyteq.com/v4/open/media/"+connector.videoHash),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Content-Type","application/json"),xhr.setRequestHeader("X-Content-Type-Options","nosniff"),xhr.onloadend=function(){200!=xhr.status&&(connector.defaultUrls?(connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.createVideoPlayerInstance({data:{}})):document.getElementById(connector.videoPlayerId).textContent="Your video is no longer available")},xhr.onload=function(data){var response=JSON.parse(xhr.response);connector.setVideoUrl(response.data.urls.video),connector.setPosterUrl(response.data.urls),connector.setParameterData(response.data.parameters),connector.createVideoPlayerInstance(response),connector.createAnalyticDevice(),connector.dataCallbackFunction&&eval("window."+connector.dataCallbackFunction+"()")},xhr.send()):connector.mediaData?(connector.mediaData.urls?(connector.setVideoUrl(connector.mediaData.urls.video),connector.mediaData.urls.gif?connector.setPosterUrl(connector.mediaData.urls.gif):connector.mediaData.urls.image&&connector.setPosterUrl(connector.mediaData.urls.image)):(connector.setVideoUrl(connector.mediaData.video_url),connector.setPosterUrl(connector.mediaData.poster_url)),connector.createVideoPlayerInstance({data:connector.mediaData}),connector.createAnalyticDevice()):connector.defaultUrls?(connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.createVideoPlayerInstance({data:{}})):(document.getElementById(connector.videoPlayerId).innerHTML="No video hash has been given",document.getElementById(connector.videoPlayerId).style="text-align: center;background:#000;color:#fff;font-weight:900;height:200px;line-height:200px;")},StoryteqVideoPlayer.prototype.getBrowser=function(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===o[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),{name:o[0].toLowerCase(),version:o[1]})},StoryteqVideoPlayer.prototype.getOs=function(){var e=window.navigator.userAgent,t=window.navigator.platform,o="other";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?o="mac":-1!==["iPhone","iPad","iPod"].indexOf(t)?o=t:-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?o="windows":/Android/.test(e)?o="android":!o&&/Linux/.test(t)&&(o="linux"),{name:o}},StoryteqVideoPlayer.prototype.getPlatform=function(){var e=this.getOs(),t="desktop";return-1!==["android","iPhone","iPad","iPod"].indexOf(e.name)&&(t="mobile"),t},StoryteqVideoPlayer.prototype.createAnalyticDevice=function(){var e=this,t={browser:e.getBrowser(),os:e.getOs(),platform:e.getPlatform(),player:"videojs"};e.verbose&&console.log(t),this.analyticPostRequest("device",t)},StoryteqVideoPlayer.prototype.createAnalyticView=function(e){var t={percentage:e};this.verbose&&console.log(t),this.analyticPostRequest("view",t)},StoryteqVideoPlayer.prototype.createAnalyticEmbed=function(){this.analyticPostRequest("embed",null)},StoryteqVideoPlayer.prototype.getParameterValueByName=function(e){if(!this.parameterData)return console.warn("Using template parameter data is disabled for this template"),null;for(var t=0;t<this.parameterData.length;t++)if(this.parameterData[t].name==e)return this.parameterData[t].value},StoryteqVideoPlayer.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},StoryteqVideoPlayer.prototype.setVideoUrl=function(e){this.videoUrl&&""!==this.videoUrl||(this.videoUrl=e)},StoryteqVideoPlayer.prototype.setPosterUrl=function(e){this.posterUrl&&""!==this.posterUrl||(e.hasOwnProperty("gif")?this.posterUrl=e.gif:e.hasOwnProperty("image")&&(this.posterUrl=e.image))},StoryteqVideoPlayer.prototype.getVideoUrl=function(){return this.videoUrl},StoryteqVideoPlayer.prototype.getPosterUrl=function(){return this.posterUrl},StoryteqVideoPlayer.prototype.setParameterData=function(e){this.parameterData=e},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=StoryteqVideoPlayer:"undefined"!=typeof require?define(StoryteqVideoPlayer):window.StoryteqVideoPlayer=StoryteqVideoPlayer;