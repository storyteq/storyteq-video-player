function StoryteqVideoPlayer(e){var t=this;if(!e.videoPlayerId)throw new Error("Missing videoPlayerID.");if(t.videoPlayerId=e.videoPlayerId,t.tracking=!0,e.mediaData)t.mediaData=e.mediaData;else if(e.videoHash)t.videoHash=e.videoHash;else{if(!e.videoParameterName)throw new Error("Missing videoParameterName or videoHash or mediaData.");t.videoHash=t.getUrlParameter(e.videoParameterName)}e.verbose&&(t.verbose=e.verbose),0==e.tracking&&(t.tracking=e.tracking),e.dataCallbackFunction&&(t.dataCallbackFunction=e.dataCallbackFunction),e.defaultUrls&&(t.defaultUrls=e.defaultUrls),e.subs&&(t.subs=e.subs),e.playerSetup&&(t.playerSetup=e.playerSetup),e.events&&(t.events=e.events),e.posterUrl&&(t.posterUrl=e.posterUrl),e.noPoster&&(t.noPoster=e.noPoster),void 0!==e.autoplay&&(t.autoplay=e.autoplay),t.delta=20,t.durationOfVideo=null,t.timecodes=[],t.videoStarted=!1,t.firstPlay=!0,t.previousEvent=null,t.loadVideoJsCss()}function StoryteqConnectorJwPlayer(e){return new StoryteqVideoPlayer(e)}StoryteqVideoPlayer.prototype.loadVideoJsCss=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJsTheme():t.onload=function(){e.loadVideoJsTheme()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJsTheme=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js-theme.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJs():t.onload=function(){e.loadVideoJs()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJs=function(){var e=this,t=document.createElement("script");t.type="text/javascript",t.readyState?"loaded"===t.readyState&&e.getVideoData():t.onload=function(){e.getVideoData()},t.src="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.js",document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.createVideoPlayerInstance=function(e){var t=document.getElementById(this.videoPlayerId),o=document.createElement("video");o.id=this.videoPlayerId,o.className="video-js vjs-16-9",t.parentNode.replaceChild(o,t);var r=videojs(this.videoPlayerId,{poster:this.noPoster?"":this.posterUrl,sources:this.videoUrl,controls:!0,autoplay:0!=this.autoplay,preload:"auto",muted:0!=this.autoplay});if(this.videoUrl&&(this.verbose&&console.log("Video embedded"),document.getElementById(o.id).addEventListener("contextmenu",function(e){e.preventDefault()}),this.createAnalyticEmbed()),this.events)for(var a in this.events)r.on(a,this.events[a]);this.videoEventEmitter(r)},StoryteqVideoPlayer.prototype.round=function(e,t){var o=Math.pow(100,t||0);return Math.round(e*o)/o},StoryteqVideoPlayer.prototype.videoEventEmitter=function(e){var t=this;e.on("seeked",function(){t.timecodes.forEach(function(e){e.passed=!1})}),setInterval(function(){var o=e.currentTime();if(o>1&&null==t.durationOfVideo){t.durationOfVideo=e.duration();for(var r=0;r<=t.delta;r+=1)t.timecodes[r]={percentage:1*r/t.delta,value:r/t.delta*t.durationOfVideo,passed:!1}}null!=t.durationOfVideo&&t.timecodes.forEach(function(e){if(o>=e.value&&o-e.value<t.durationOfVideo/t.delta&&0==e.passed){var r=t.round(100*e.percentage,1);t.previousEvent!=r&&(t.verbose&&console.log("Video watched for "+r+"%"),t.createAnalyticView(r),e.passed=!0,t.previousEvent=r)}else t.skipNextEvent=!1})},500)},StoryteqVideoPlayer.prototype.analyticPostRequest=function(e,t){if((null!=this.mediaData||null!=this.videoHash&&""!=this.videoHash)&&0!=this.tracking){var o=this.videoHash;null!=this.mediaData&&(o=mediaData.hash);var r=new XMLHttpRequest,a="https://api.storyteq.com/v4/open/media/"+o;r.open("POST",a),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("X-Content-Type-Options","nosniff"),r.send(JSON.stringify({type:e,meta:t}))}else this.verbose&&console.log("No analytics will be created since no unique hash has been provided or tracking has been disabled.")},StoryteqVideoPlayer.prototype.getVideoData=function(){var connector=this;if(connector.videoHash&&null!==connector.videoHash){var xhr=new XMLHttpRequest;xhr.open("GET","https://api.storyteq.com/v4/open/media/"+connector.videoHash),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Content-Type","application/json"),xhr.setRequestHeader("X-Content-Type-Options","nosniff"),xhr.onloadend=function(){if(200!=xhr.status)if(connector.defaultUrls)connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.createVideoPlayerInstance({data:{}});else{document.getElementById(connector.videoPlayerId).textContent="Your video is no longer available"}},xhr.onload=function(data){var response=JSON.parse(xhr.response);connector.setVideoUrl(response.data.urls.video),connector.setPosterUrl(response.data.urls),connector.setParameterData(response.data.parameters),connector.createVideoPlayerInstance(response),connector.createAnalyticDevice(),connector.dataCallbackFunction&&eval("window."+connector.dataCallbackFunction+"()")},xhr.send()}else connector.mediaData?(connector.mediaData.urls?(connector.setVideoUrl(connector.mediaData.urls.video),connector.mediaData.urls.gif?connector.setPosterUrl(connector.mediaData.urls.gif):connector.mediaData.urls.image&&connector.setPosterUrl(connector.mediaData.urls.image)):(connector.setVideoUrl(connector.mediaData.video_url),connector.setPosterUrl(connector.mediaData.poster_url)),connector.createVideoPlayerInstance({data:connector.mediaData}),connector.createAnalyticDevice()):connector.defaultUrls?(connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.createVideoPlayerInstance({data:{}})):(document.getElementById(connector.videoPlayerId).innerHTML="No video hash has been given",document.getElementById(connector.videoPlayerId).style="text-align: center;background:#000;color:#fff;font-weight:900;height:200px;line-height:200px;")},StoryteqVideoPlayer.prototype.getBrowser=function(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===o[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),{name:o[0].toLowerCase(),version:o[1]})},StoryteqVideoPlayer.prototype.getOs=function(){var e=window.navigator.userAgent,t=window.navigator.platform,o="other";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?o="mac":-1!==["iPhone","iPad","iPod"].indexOf(t)?o=t:-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?o="windows":/Android/.test(e)?o="android":!o&&/Linux/.test(t)&&(o="linux"),{name:o}},StoryteqVideoPlayer.prototype.getPlatform=function(){var e=this.getOs(),t="desktop";return-1!==["android","iPhone","iPad","iPod"].indexOf(e.name)&&(t="mobile"),t},StoryteqVideoPlayer.prototype.createAnalyticDevice=function(){var e={browser:this.getBrowser(),os:this.getOs(),platform:this.getPlatform(),player:"videojs"};this.verbose&&console.log(e),this.analyticPostRequest("device",e)},StoryteqVideoPlayer.prototype.createAnalyticView=function(e){var t={percentage:e};this.verbose&&console.log(t),this.analyticPostRequest("view",t)},StoryteqVideoPlayer.prototype.createAnalyticEmbed=function(){this.analyticPostRequest("embed",null)},StoryteqVideoPlayer.prototype.getParameterValueByName=function(e){if(!this.parameterData)return console.warn("Using template parameter data is disabled for this template"),null;for(var t=0;t<this.parameterData.length;t++)if(this.parameterData[t].name==e)return this.parameterData[t].value},StoryteqVideoPlayer.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},StoryteqVideoPlayer.prototype.setVideoUrl=function(e){this.videoUrl&&""!==this.videoUrl||(this.videoUrl=e)},StoryteqVideoPlayer.prototype.setPosterUrl=function(e){this.posterUrl&&""!==this.posterUrl||(e.hasOwnProperty("gif")?this.posterUrl=e.gif:e.hasOwnProperty("image")&&(this.posterUrl=e.image))},StoryteqVideoPlayer.prototype.getVideoUrl=function(){return this.videoUrl},StoryteqVideoPlayer.prototype.getPosterUrl=function(){return this.posterUrl},StoryteqVideoPlayer.prototype.setParameterData=function(e){this.parameterData=e},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=StoryteqVideoPlayer:"undefined"!=typeof require?define(StoryteqVideoPlayer):window.StoryteqVideoPlayer=StoryteqVideoPlayer;