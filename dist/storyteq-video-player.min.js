function StoryteqVideoPlayer(e){var t=this;if(!e.videoPlayerId)throw new Error("Missing videoPlayerID.");if(t.videoPlayerId=e.videoPlayerId,t.tracking=!0,e.mediaData)t.mediaData=e.mediaData;else if(e.videoHash)t.videoHash=e.videoHash;else{if(!e.videoParameterName)throw new Error("Missing videoParameterName or videoHash or mediaData.");t.videoHash=t.getUrlParameter(e.videoParameterName)}e.verbose&&(t.verbose=e.verbose),0==e.tracking&&(t.tracking=e.tracking),e.dataCallbackFunction&&(t.dataCallbackFunction=e.dataCallbackFunction),e.defaultUrls&&(t.defaultUrls=e.defaultUrls),e.subs&&(t.subs=e.subs),e.playerSetup&&(t.playerSetup=e.playerSetup),e.events&&(t.events=e.events),e.posterUrl&&(t.posterUrl=e.posterUrl),e.noPoster&&(t.noPoster=e.noPoster),t.delta=20,t.durationOfVideo=null,t.timecodes=[],t.videoStarted=!1,t.firstPlay=!0,t.previousEvent=null,t.loadVideoJsCss()}function StoryteqConnectorJwPlayer(e){return new StoryteqVideoPlayer(e)}StoryteqVideoPlayer.prototype.loadVideoJsCss=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJsTheme():t.onload=function(){e.loadVideoJsTheme()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJsTheme=function(){var e=this,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="https://storage.googleapis.com/storyteq-video-player/dist/video-js-theme.min.css",t.readyState?"loaded"===t.readyState&&e.loadVideoJs():t.onload=function(){e.loadVideoJs()},document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.loadVideoJs=function(){var e=this,t=document.createElement("script");t.type="text/javascript",t.readyState?"loaded"===t.readyState&&e.getVideoData():t.onload=function(){e.getVideoData()},t.src="https://storage.googleapis.com/storyteq-video-player/dist/video-js.min.js",document.getElementsByTagName("head")[0].appendChild(t)},StoryteqVideoPlayer.prototype.createVideoPlayerInstance=function(e){var t=this,o=document.getElementById(t.videoPlayerId),r=document.createElement("video");r.id=t.videoPlayerId,r.className="video-js vjs-16-9",o.parentNode.replaceChild(r,o);var a=videojs(t.videoPlayerId,{poster:t.noPoster?"":t.posterUrl,sources:t.videoUrl,controls:!0,autoplay:!0,preload:"auto",muted:!0});if(t.videoUrl&&(t.verbose&&console.log("Video embedded"),document.getElementById("player").addEventListener("contextmenu",e=>{e.preventDefault()}),t.createAnalyticEmbed()),t.events)for(var n in t.events)a.on(n,t.events[n]);this.videoEventEmitter(a)},StoryteqVideoPlayer.prototype.round=function(e,t){var o=Math.pow(100,t||0);return Math.round(e*o)/o},StoryteqVideoPlayer.prototype.videoEventEmitter=function(e){var t=this;e.on("seeked",function(){t.timecodes.forEach(function(e){e.passed=!1})}),setInterval(function(){var o=e.currentTime();if(o>1&&null==t.durationOfVideo){t.durationOfVideo=e.duration();for(var r=0;r<=t.delta;r+=1)t.timecodes[r]={percentage:1*r/t.delta,value:r/t.delta*t.durationOfVideo,passed:!1}}null!=t.durationOfVideo&&t.timecodes.forEach(function(e){if(o>=e.value&&o-e.value<t.durationOfVideo/t.delta&&0==e.passed){var r=t.round(100*e.percentage,1);t.previousEvent!=r&&(t.verbose&&console.log("Video watched for "+r+"%"),t.createAnalyticView(r),e.passed=!0,t.previousEvent=r)}else t.skipNextEvent=!1})},500)},StoryteqVideoPlayer.prototype.analyticPostRequest=function(e,t){var o=this;if((null!=this.mediaData||null!=this.videoHash&&""!=this.videoHash)&&0!=this.tracking){var r=this.videoHash;null!=this.mediaData&&(r=mediaData.hash);var a=new XMLHttpRequest,n="https://api.storyteq.com/v4/open/media/"+r;a.open("POST",n),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("X-Content-Type-Options","nosniff"),a.send(JSON.stringify({type:e,meta:t}))}else o.verbose&&console.log("No analytics will be created since no unique hash has been provided or tracking has been disabled.")},StoryteqVideoPlayer.prototype.getVideoData=function(){var connector=this;if(connector.videoHash&&null!==connector.videoHash){var xhr=new XMLHttpRequest;xhr.open("GET","https://api.storyteq.com/v4/open/media/"+connector.videoHash),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Content-Type","application/json"),xhr.setRequestHeader("X-Content-Type-Options","nosniff"),xhr.onload=function(data){var response=JSON.parse(xhr.response);connector.setVideoUrl(response.data.urls.video),connector.setPosterUrl(response.data.urls),connector.setParameterData(response.data.parameters),connector.createVideoPlayerInstance(response),connector.createAnalyticDevice(),connector.dataCallbackFunction&&eval("window."+connector.dataCallbackFunction+"()")},xhr.send()}else connector.mediaData?(connector.mediaData.urls?(connector.setVideoUrl(connector.mediaData.urls.video),connector.mediaData.urls.gif?connector.setPosterUrl(connector.mediaData.urls.gif):connector.mediaData.urls.image&&connector.setPosterUrl(connector.mediaData.urls.image)):(connector.setVideoUrl(connector.mediaData.video_url),connector.setPosterUrl(connector.mediaData.poster_url)),connector.createVideoPlayerInstance({data:connector.mediaData}),connector.createAnalyticDevice()):connector.defaultUrls?(connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.createVideoPlayerInstance({data:{}})):(document.getElementById(connector.videoPlayerId).innerHTML="No video hash has been given",document.getElementById(connector.videoPlayerId).style="text-align: center;background:#000;color:#fff;font-weight:900;height:200px;line-height:200px;")},StoryteqVideoPlayer.prototype.getBrowser=function(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"IE",version:e[1]||""}):"Chrome"===o[1]&&(e=t.match(/\bOPR|Edge\/(\d+)/),null!=e)?{name:"Opera",version:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),{name:o[0].toLowerCase(),version:o[1]})},StoryteqVideoPlayer.prototype.getOs=function(){var e=window.navigator.userAgent,t=window.navigator.platform,o=["Macintosh","MacIntel","MacPPC","Mac68K"],r=["Win32","Win64","Windows","WinCE"],a=["iPhone","iPad","iPod"],n="other";return-1!==o.indexOf(t)?n="mac":-1!==a.indexOf(t)?n=t:-1!==r.indexOf(t)?n="windows":/Android/.test(e)?n="android":!n&&/Linux/.test(t)&&(n="linux"),{name:n}},StoryteqVideoPlayer.prototype.getPlatform=function(){var e=this,t=e.getOs(),o=["android","iPhone","iPad","iPod"],r="desktop";return-1!==o.indexOf(t.name)&&(r="mobile"),r},StoryteqVideoPlayer.prototype.createAnalyticDevice=function(){var e=this,t={browser:e.getBrowser(),os:e.getOs(),platform:e.getPlatform(),player:"videojs"};e.verbose&&console.log(t),this.analyticPostRequest("device",t)},StoryteqVideoPlayer.prototype.createAnalyticView=function(e){var t=this,o={percentage:e};t.verbose&&console.log(o),t.analyticPostRequest("view",o)},StoryteqVideoPlayer.prototype.createAnalyticEmbed=function(){var e=this;e.analyticPostRequest("embed",null)},StoryteqVideoPlayer.prototype.getParameterValueByName=function(e){for(var t=0;t<this.parameterData.length;t++)if(this.parameterData[t].name==e)return this.parameterData[t].value},StoryteqVideoPlayer.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=t.exec(location.search);return null===o?"":decodeURIComponent(o[1].replace(/\+/g," "))},StoryteqVideoPlayer.prototype.setVideoUrl=function(e){var t=this;t.videoUrl&&""!==t.videoUrl||(this.videoUrl=e)},StoryteqVideoPlayer.prototype.setPosterUrl=function(e){var t=this;t.posterUrl&&""!==t.posterUrl||(e.hasOwnProperty("gif")?this.posterUrl=e.gif:e.hasOwnProperty("image")&&(this.posterUrl=e.image))},StoryteqVideoPlayer.prototype.getVideoUrl=function(){return this.videoUrl},StoryteqVideoPlayer.prototype.getPosterUrl=function(){return this.posterUrl},StoryteqVideoPlayer.prototype.setParameterData=function(e){this.parameterData=e},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=StoryteqVideoPlayer:"undefined"!=typeof require?define(StoryteqVideoPlayer):window.StoryteqVideoPlayer=StoryteqVideoPlayer;